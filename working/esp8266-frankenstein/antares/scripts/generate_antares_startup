#!/bin/bash
# Generate a dummy C callind startup functions

DECL=""
scan() { 
    find "$1" -iname "*.$2" |while read f; do
	cat "$f" | while read l; do 
	    echo -e DECL=\""\$DECL\n extern void ${4}$l(void);"\"
	    echo -e $3=\""\$3\n ${4}$l();"\"
	done 
    done
}


eval `scan $1 a_init_low  INIT_LOW  antares_init_low_`
eval `scan $1 a_init_high INIT_HIGH antares_init_high_`
eval `scan $1 a_app       APP       antares_app_`
eval `scan $1 a_fini      FINISH    antares_finish_`

cat <<EOF
/* Autogenerated antares startup file, do not edit */
${DECL}
int do_antares_startup() { 
 ${INIT_LOW}
 ${INIT_HIGH}
 while (1) { 
  ${APP}
 }
 ${FINISH}
}
EOF

